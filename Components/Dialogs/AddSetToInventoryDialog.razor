@using MudBlazor


<MudDialog>
    <DialogContent>
        <MudText>Do you want to add all @ItemCount bricks of this set to your inventory?</MudText>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Cancel" Disabled="_loading">Cancel</MudButton>
        <MudButton Color="Color.Success" OnClick="ConfirmAsync" Disabled="_loading">Add</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter]
    private IMudDialogInstance? MudDialog { get; set; }

    [Parameter]
    public int ItemCount { get; set; }

    [Inject]
    public brickisbrickapp.Services.LoadingService LoadingService { get; set; } = default!;
    [Inject]
    public brickisbrickapp.Services.InventoryService InventoryService { get; set; } = default!;
    [Parameter]
    public int ItemSetId { get; set; }

    private bool _loading = false;

    private void Cancel()
    {
        if (!_loading)
            MudDialog?.Close(false);
    }

    private async Task ConfirmAsync()
    {
        _loading = true;
        await InvokeAsync(StateHasChanged);
        await Task.Delay(100); // UI render pause for spinner
        LoadingService.Show();
        try
        {
            await InventoryService.AddSetBricksToInventoryAsync(ItemSetId);
            MudDialog?.Close(true);
        }
        finally
        {
            LoadingService.Hide();
            _loading = false;
        }
    }
}
