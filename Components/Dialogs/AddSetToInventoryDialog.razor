
@using MudBlazor


<MudDialog>
    <DialogContent>
        <MudText>Möchtest du alle @ItemCount Steine dieses Sets zu deinem Inventar hinzufügen?</MudText>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Cancel" Disabled="_loading">Cancel</MudButton>
        <MudButton Color="Color.Success" OnClick="ConfirmAsync" Disabled="_loading">Hinzufügen</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter]
    private IMudDialogInstance? MudDialog { get; set; }

    [Parameter]
    public int ItemCount { get; set; }

    [Inject]
    public Services.LoadingService LoadingService { get; set; } = default!;
    [Inject]
    public Services.InventoryService InventoryService { get; set; } = default!;
    [Parameter]
    public int ItemSetId { get; set; }

    private bool _loading = false;

    private void Cancel()
    {
        if (!_loading)
            MudDialog?.Close(false);
    }

    private async Task ConfirmAsync()
    {
        _loading = true;
        await InvokeAsync(StateHasChanged);
        await Task.Delay(100); // UI-Render-Pause für Spinner
        LoadingService.Show();
        try
        {
            await InventoryService.AddSetBricksToInventoryAsync(ItemSetId);
            MudDialog?.Close(true);
        }
        finally
        {
            LoadingService.Hide();
            _loading = false;
        }
    }
}
