@using brickapp.Data.Entities
@using brickapp.Data.DTOs

@inject Data.Services.MappedBrickService BrickService
@inject Data.Services.WantedListService WantedListService
@inject Data.Services.NotificationService NotificationService
@inject Data.Services.LoadingService LoadingService

<MudDialog>
    <DialogContent>
        <MudText Typo="Typo.h6" GutterBottom="true">Add Item to Wanted List</MudText>

        @if (_step == 1)
        {
            <!-- Step 1: Select Brick, Color, Quantity -->
            <BrickPicker OnBrickAdded="HandleBrickSelected" 
                         Label="Search for a brick" 
                         Placeholder="Enter part number or name..."
                         AddButtonText="Next: Select Wanted List"
                         ShowQuickColorPicker="true"
                         ShowBrandSelector="false"
                         PreselectedBrick="@PreselectedBrick" />
        }
        else if (_step == 2)
        {
            <!-- Step 2: Select or Create Wanted List -->
            @if (_loadingLists)
            {
                <MudProgressCircular Indeterminate="true" />
            }
            else
            {
                <MudPaper Class="pa-3 mb-3" Elevation="0" Style="background-color: var(--mud-palette-background-grey);">
                    <MudText Typo="Typo.body2"><strong>Selected Item:</strong></MudText>
                    <MudText Typo="Typo.body1">@_selectedBrickName</MudText>
                    <MudText Typo="Typo.caption">Quantity: @_selectedQuantity | Color: @_selectedColorName</MudText>
                </MudPaper>

                <MudStack Spacing="2">
                    <MudSelect T="int?" Label="Add to existing wanted list" Variant="Variant.Outlined"
                               @bind-Value="_selectedWantedListId" Disabled="_saving">
                        <MudSelectItem T="int?" Value="null">-- select --</MudSelectItem>
                        @foreach (var wl in _wantedLists)
                        {
                            <MudSelectItem T="int?" Value="@wl.Id">@wl.Name</MudSelectItem>
                        }
                    </MudSelect>

                    <MudDivider />

                    <MudTextField Label="Or create a new wanted list" Variant="Variant.Outlined"
                                  @bind-Value="_newListName" Disabled="_saving" />

                    @if (!string.IsNullOrWhiteSpace(_error))
                    {
                        <MudAlert Severity="Severity.Error">@_error</MudAlert>
                    }
                </MudStack>
            }
        }

        <!-- Error Message -->
        @if (!string.IsNullOrEmpty(_errorMessage))
        {
            <MudAlert Severity="Severity.Error">@_errorMessage</MudAlert>
        }
    </DialogContent>
    <DialogActions>
        @if (_step == 1)
        {
            <MudButton Color="Color.Secondary" OnClick="Cancel">Cancel</MudButton>
        }
        else if (_step == 2)
        {
            <MudButton Color="Color.Secondary" OnClick="BackToStep1" Disabled="_saving">Back</MudButton>
            <MudButton Color="Color.Primary" Variant="Variant.Filled" OnClick="Save" Disabled="@(_saving || _loadingLists)">
                Add to Wanted List
            </MudButton>
        }
    </DialogActions>
</MudDialog>

@code {

    // Step 1: Selected brick data

    // Step 2: Wanted list selection

}
