@using brickapp.Data.Services

<MudDialog>
    <DialogContent>
        <MudText Typo="Typo.h6" Class="mb-3">Approve Item Request</MudText>

        <MudText Typo="Typo.body2" Class="mb-2" Color="Color.Default">
            <strong>User's suggested name:</strong>
        </MudText>
        <MudPaper Class="pa-3 mb-3" Elevation="0" Style="background-color: var(--mud-palette-background-grey);">
            <MudText Typo="Typo.body1">@CurrentName</MudText>
        </MudPaper>

        <MudTextField @bind-Value="_name"
                      Label="Final Name"
                      Variant="Variant.Outlined"
                      Required="true"
                      Immediate="true"
                      HelperText="Edit the name if needed" />

        @if (!string.IsNullOrWhiteSpace(PartNum) && Brand?.ToLower() == "lego")
        {
            <MudButton Variant="Variant.Outlined"
                       Color="Color.Info"
                       StartIcon="@Icons.Material.Filled.Download"
                       Class="mt-2"
                       OnClick="FetchBricklinkName"
                       Disabled="_isFetching">
                @if (_isFetching)
                {
                    <MudProgressCircular Size="Size.Small" Indeterminate="true" />
                    <span class="ml-2">Fetching...</span>
                }
                else
                {
                    <span>Try to get Bricklink name</span>
                }
            </MudButton>

            @if (!string.IsNullOrWhiteSpace(_fetchMessage))
            {
                <MudAlert Severity="_fetchSuccess ? Severity.Success : Severity.Warning" 
                          Class="mt-2" Dense="true">
                    @_fetchMessage
                </MudAlert>
            }
        }

        @if (NameChanged)
        {
            <MudAlert Severity="Severity.Info" Class="mt-2" Dense="true">
                The user will be notified that the name was changed by admin.
            </MudAlert>
        }
    </DialogContent>

    <DialogActions>
        <MudButton Variant="Variant.Text" Color="Color.Secondary" OnClick="Cancel">
            Cancel
        </MudButton>

        <MudButton Variant="Variant.Filled"
                   Color="Color.Success"
                   Disabled="@string.IsNullOrWhiteSpace(_name)"
                   OnClick="Approve">
            @(NameChanged ? "Approve with Name Change" : "Approve")
        </MudButton>
    </DialogActions>
</MudDialog>