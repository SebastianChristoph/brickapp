@page "/admin-requests"
@using Microsoft.AspNetCore.Components

<PageTitle>Admin Requests</PageTitle>

<h3>Admin Requests</h3>

<MudTabs>
    <MudTabPanel Text="@(openMappingRequests == null ? "Mapping Requests" : $"Mapping Requests ({openMappingRequests.Count})")">
        @if (openMappingRequests == null)
        {
            <MudProgressCircular Indeterminate="true" />
        }
        else if (!openMappingRequests.Any())
        {
            <MudText>No open mapping requests found.</MudText>
        }
        else
        {
            <MudTable Items="openMappingRequests" Hover="true">
                <HeaderContent>
                    <MudTh>Id</MudTh>
                    <MudTh>Brick</MudTh>
                    <MudTh>Brand</MudTh>
                    <MudTh>Mapping Name</MudTh>
                    <MudTh>Mapping ItemId</MudTh>
                    <MudTh>Requested By</MudTh>
                    <MudTh>Created At</MudTh>
                <!-- Actions column entfernt -->
                </HeaderContent>
                <RowTemplate>
                    <MudTd DataLabel="Id">@context.Id</MudTd>
                    <MudTd DataLabel="Brick">@context.Brick?.Name</MudTd>
                    <MudTd DataLabel="Brand">@context.Brand</MudTd>
                    <MudTd DataLabel="Mapping Name">@context.MappingName</MudTd>
                    <MudTd DataLabel="Mapping ItemId">@context.MappingItemId</MudTd>
                    <MudTd DataLabel="Requested By">@context.RequestedByUser?.Name</MudTd>
                    <MudTd DataLabel="Created At">@context.CreatedAt.ToLocalTime().ToString("g")</MudTd>
                    <MudTd DataLabel="Actions">
                     
                    </MudTd>
                </RowTemplate>
            </MudTable>
        }
    </MudTabPanel>
    <MudTabPanel Text="@(openItemRequests == null ? "Item Requests" : $"Item Requests ({openItemRequests.Count})")">
        @if (openItemRequests == null)
        {
            <MudProgressCircular Indeterminate="true" />
        }
        else if (!openItemRequests.Any())
        {
            <MudText>No open item requests found.</MudText>
        }
        else
        {
            <MudTable Items="openItemRequests" Hover="true">
                <HeaderContent>
                    <MudTh>Id</MudTh>
                    <MudTh>Brand</MudTh>
                    <MudTh>Name</MudTh>
                    <MudTh>Requested By</MudTh>
                    <MudTh>Created At</MudTh>
                    <MudTh>Status</MudTh>
                </HeaderContent>
                <RowTemplate>
                    <MudTd DataLabel="Id">@context.Id</MudTd>
                    <MudTd DataLabel="Brand">@context.Brand</MudTd>
                    <MudTd DataLabel="Name">@context.Name</MudTd>
                    <MudTd DataLabel="Requested By">@context.RequestedByUser?.Name ?? @context.RequestedByUserId</MudTd>
                    <MudTd DataLabel="Created At">@context.CreatedAt.ToLocalTime().ToString("g")</MudTd>
                    <MudTd DataLabel="Status">@context.Status.ToString()</MudTd>
                </RowTemplate>
            </MudTable>
        }
    </MudTabPanel>
    <MudTabPanel Text="@(setRequests == null ? "Set Requests" : $"Set Requests ({setRequests.Count})")">
        <p>Set Requests content goes here.</p>
    </MudTabPanel>

    
    </MudTabs>

    @code {
    [Inject] private brickisbrickapp.Data.Services.MappingRequestService MappingRequestService { get; set; } = default!;
    [Inject] private brickisbrickapp.Data.Services.NewItemRequestService NewItemRequestService { get; set; } = default!;

    private List<brickisbrickapp.Data.Entities.MappingRequest>? openMappingRequests;
    private List<brickisbrickapp.Data.Entities.NewItemRequest>? openItemRequests;
    private List<object>? setRequests;

        protected override async Task OnInitializedAsync()
        {
            openMappingRequests = await MappingRequestService.GetOpenRequestsAsync();
            openItemRequests = await NewItemRequestService.GetOpenRequestsAsync();
        }
    }
   