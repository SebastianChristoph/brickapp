@inject Services.LoadingService LoadingService
@implements IDisposable


<style>
.global-loading-overlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(255,255,255,0.7);
    z-index: 9999;
    display: flex;
    align-items: center;
    justify-content: center;
}
</style>

@if (_visible)
{
    <div class="global-loading-overlay">
        <MudStack Spacing="2" AlignItems="AlignItems.Center">
            <MudProgressCircular Indeterminate="true" Size="Size.Large" Color="Color.Primary" />
            <MudText Typo="Typo.subtitle1" Align="Align.Center">@(_message ?? "Loading data")</MudText>
        </MudStack>
    </div>
}

@code {
    private bool _visible;
    private string? _message;

    protected override void OnInitialized()
    {
        LoadingService.OnShow += Show;
        LoadingService.OnHide += Hide;
        _visible = LoadingService.IsLoading;
    }

    private void Show(string? message = null)
    {
        _message = message;
        _visible = true;
        InvokeAsync(StateHasChanged);
    }
    private void Hide()
    {
        _visible = false;
        _message = null;
        InvokeAsync(StateHasChanged);
    }
    public void Dispose()
    {
        LoadingService.OnShow -= Show;
        LoadingService.OnHide -= Hide;
    }
}

